<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Place Picker Widget - Google Places API</title>

    <!--external styles-->
    <link rel="stylesheet" href="external/bootstrap-4.1.3/css/bootstrap.min.css">

    <!--custom styles-->
    <link rel="stylesheet" href="styles.css">

    <!--google api key-->
    <script type="text/javascript" src="google_api_key.js"></script>
</head>
<body>

<div class="places-service"></div>

<div class="card">
    <div class="card-body">
        <div class="" action="" method="">
            <div class="form-group">
                <div class="form-text">
                    <label for="pickupLocation" class="">Pick-up location</label>
                </div>
                <div class="location-input-wrapper">
                    <input type="text" id="pickupLocation"
                           placeholder="airport, hotel name, railway station, street address..."
                           value=""
                           class="form-control">
                    <div class="location-dropdown">
                        <ul></ul>
                        <div><img src="img/powered-by-google.png" align="right"></div>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <div class="form-text">
                    <label for="dropoffLocation" class="">Drop-off location</label>
                </div>
                <div class="location-input-wrapper">
                    <input type="text" id="dropoffLocation"
                           placeholder="airport, hotel name, railway station, street address..."
                           value=""
                           class="form-control">
                    <div class="location-dropdown">
                        <ul></ul>
                        <div><img src="img/powered-by-google.png" align="right"></div>
                    </div>
                </div>
            </div>
            <div class="mt-5">
                <button id="search-btn" class="btn btn-lg btn-success btn-block">Search</button>
            </div>
        </div>
    </div>
</div>

<!--js scripts-->
<script type="text/javascript" src="external/jquery-2.2.4/jquery.min.js"></script>
<script type="text/javascript" src="external/bootstrap-4.1.3/js/bootstrap.bundle.min.js"></script>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCaAecBqyUDID2RvaumspGcK_mdhe1adms&libraries=places"></script>
<script>
    Array.prototype.contains = function (value) {
        return $.inArray(value, this) !== -1;
    };
</script>
<script type="text/javascript" src="widget.js"></script>
<script>
    const pickupW = new PlacePickerWidget({
        inputId: 'pickupLocation',
        onPlaceChanged: function (widget, place_id) {
            if (place_id) {
                widget.queryPlaceDetails(place_id, function (place, status) {
                    dropoffW.setLimits({lat: place.geometry.location.lat(), lng: place.geometry.location.lng()}, 50000);
                }, null, ['geometry'], true);
            } else {
                dropoffW.setLimits(null, null);
            }
        }
    });
    const dropoffW = new PlacePickerWidget({inputId: 'dropoffLocation'});

    function submitCallback(e) {
        const pickupPlaceId = pickupW.getPlaceId();
        const dropoffPlaceId = dropoffW.getPlaceId();

        if (pickupPlaceId && dropoffPlaceId) {
            pickupW.queryPlaceDetails(pickupPlaceId, function (pickupplace) {
                dropoffW.queryPlaceDetails(dropoffPlaceId, function (dropoffplace) {
                    alert("https://www.placeholde.biz/search" + $.param({
                        from_type: 'geo',
                        to_type: 'geo',

                        pickupName: pickupplace.name,
                        pickupLatitude: pickupplace.geometry.location.lat(),
                        pickupLongitude: pickupplace.geometry.location.lng(),

                        dropoffName: dropoffplace.name,
                        dropoffLatitude: dropoffplace.geometry.location.lat(),
                        dropoffLongitude: dropoffplace.geometry.location.lng()
                    }));
                }, errorHandler, ['name', 'geometry'], true)
            }, errorHandler, ['name','geometry'], true)

        } else {
            alert("Please choose both valid locations");
        }

    }

    function errorHandler() {
        alert("Google API error");
    }

    $('#search-btn').click(submitCallback);
</script>
</body>
</html>